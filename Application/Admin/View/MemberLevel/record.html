<extend name="Common:base" />
<block name="content">
<load href="__CSS__/App/admin/admin/region.css" />
<style>
.w25{width:25%;}
.w75{width:75%;}
.w50{float:left;}
</style>
<div class="row-fluid">
    <div class="portlet box blue">
        <div class="portlet-title">
            <div class="caption">当前位置：用户中心  -- 会员卡销售记录</div>
        </div>
        <div class="portlet-body">
            <div class="form-rows">
               <form class="form-search pull-right" action="{:U('MemberLevel/record')}" method="get" style="margin-right: 15px;">
					
						<div class="from-columns column-ext">
							<label for="inside-user">会员手机号</label>
							<input id="inside-user" name="phone_number" type="text" value ="{$Think.get.phone_number}" placeholder="" style="width: 100px;">
						</div>

						<div class="from-columns column-ext">
							<label for="order-sn">个人VIP号</label>
							<input id="order-sn" name="one_number" type="text" value ="{$Think.get.one_number}" placeholder="" style="width: 100px;">
						</div>
					   <div class="from-columns column-ext">
						   <label for="order-sn">家庭VIP号</label>
						   <input id="order-sn" name="family_number" type="text" value ="{$Think.get.family_number}" placeholder="" style="width: 100px;">
					   </div>
					   <div class="from-columns">
						   <label class="control-label">
							   升级时间
						   </label>&nbsp;&nbsp;&nbsp;&nbsp;
						   <div class="input-append date date-picker start_time">
							   <input type="text" name="start_time" id="start_time" class="span9 start_time m-wrap m-ctrl-medium date-picker" size="16" value="{$Think.get.start_time}">
							   <span id="start_time" class="add-on"><i class="icon-calendar"></i></span>
						   </div>
						   <div style="width:20px;margin-left:-12px;margin-right:5px;" class="input-append">
							   <span style="background:#fff;border:none;" class="add-on">~</span>
						   </div>
						   <div class="input-append date date-picker end_time">
							   <input type="text" name="end_time" id="end_time" class="span9 end_time m-wrap m-ctrl-medium date-picker" style="width:128px;" size="16" value="{$Think.get.end_time}">
							   <span class="add-on"><i class="icon-calendar"></i></span>
						   </div>
					   </div>
					   <div class="from-columns">
						   <label for="is_onsale">是否实体卡:</label>
						   <select name="card_physical_type" style="width: 80px;">
							   <option value="1" <eq name="Think.get.card_physical_type" value="1">selected</eq>>是</option>
							   <option value="2" <eq name="Think.get.card_physical_type" value="2">selected</eq>>否</option>
							   <option value="" <eq name="Think.get.card_physical_type" value="">selected</eq>>全部</option>
						   </select>
					   </div>
						<div class="from-columns" id="check">
							<button class="btn green" type="submit" id="search_button">搜索</button>
						</div>
                </form>
            </div>
			<div class="from-columns column-ext" style="width: 400px">
				<MyTag:rule name="edit">
					<button class="btn green order-export" url="{:U('exportAppoint')}">
						导出<i class="icon-plus"></i>
					</button>
				</MyTag:rule>
				<MyTag:rule name="Admin/edit">
					<a class="btn green" href="{:U('exportAllSale')}">
						导出全部 <i class="icon-remove"></i>
					</a>
				</MyTag:rule>
				<span style="color: red">（导出全部最多支持导出前1000条）</span>
			</div>
            <table class="table table-hover">
                <thead>
                    <tr>
						<th>选项</th>
						<eq name="id_status" value="1"><th><a  href="<?php
						 	if(strpos($_SERVER['REQUEST_URI'],'?')!==false){
						 		if($a = strstr($_SERVER['REQUEST_URI'],'sort_id',true)){
						 			echo $a.sort_id.'='.'1';
						 		}else{
						 			echo $_SERVER['REQUEST_URI'].'&'.sort_id.'='.'1';
						 		};
						 	}else if(strpos($_SERVER['REQUEST_URI'],'/sort_id')!==false){
								echo preg_replace('/\/sort_id\/(\d+)/i', '/sort_id/1', $_SERVER['REQUEST_URI']);
						 	}else{
						 		if($a = strstr($_SERVER['REQUEST_URI'],'sort_id',true)){
						 			echo $a.sort_id.'='.'1';
						 		}else{
						 			echo $_SERVER['REQUEST_URI'].'&'.sort_id.'='.'1';
						 		};
							}
						?>">编号&nbsp;<img src="__IMG__/admin/icon_down.png" alt="" style="height: 15px;margin-left: 4px;"></a></th></eq>
						<eq name="id_status" value="2"><th><a  href="<?php
						 	if(strpos($_SERVER['REQUEST_URI'],'?')!==false){
						 		if($a = strstr($_SERVER['REQUEST_URI'],'sort_id',true)){
						 			echo $a.sort_id.'='.'2';
						 		}else{
						 			echo $_SERVER['REQUEST_URI'].'&'.sort_id.'='.'2';
						 		};
						 	}else if(strpos($_SERVER['REQUEST_URI'],'/sort_id')!==false){
								echo preg_replace('/\/sort_id\/(\d+)/i', '/sort_id/2', $_SERVER['REQUEST_URI']);
						 	}else{
						 		if($a = strstr($_SERVER['REQUEST_URI'],'sort_id',true)){
						 			echo $a.sort_id.'='.'2';
						 		}else{
						 			echo $_SERVER['REQUEST_URI'].'&'.sort_id.'='.'2';
						 		};
							}
						?>">编号&nbsp;<img src="__IMG__/admin/icon_up.png" alt="" style="height: 15px;margin-left: 4px;"></a></th></eq>
						<eq name="id_status" value="3"><th><a  href="<?php
						 	if(strpos($_SERVER['REQUEST_URI'],'?')!==false){
						 		if($a = strstr($_SERVER['REQUEST_URI'],'sort_id',true)){
						 			echo $a.sort_id.'='.'3';
						 		}else{
						 			echo $_SERVER['REQUEST_URI'].'&'.sort_id.'='.'3';
						 		};
						 	}else if(strpos($_SERVER['REQUEST_URI'],'/sort_id')!==false){
								echo preg_replace('/\/sort_id\/(\d+)/i', '/sort_id/3', $_SERVER['REQUEST_URI']);
						 	}else{
						 		if($a = strstr($_SERVER['REQUEST_URI'],'sort_id',true)){
						 			echo $a.sort_id.'='.'3';
						 		}else{
						 			echo $_SERVER['REQUEST_URI'].'&'.sort_id.'='.'3';
						 		};
							}
						?>">编号&nbsp;<img src="__IMG__/admin/icon_normal.png" alt="" style="height: 15px;margin-left: 4px;"></a></th></eq>
                        <th>会员手机号</th>
                        <th>个人VIP卡号</th>
                        <th>家庭VIP卡号</th>
						<eq name="username_status" value="4"><th><a  href="<?php
						 	if(strpos($_SERVER['REQUEST_URI'],'?')!==false){
						 		if($a = strstr($_SERVER['REQUEST_URI'],'sort_id',true)){
						 			echo $a.sort_id.'='.'4';
						 		}else{
						 			echo $_SERVER['REQUEST_URI'].'&'.sort_id.'='.'4';
						 		};
						 	}else if(strpos($_SERVER['REQUEST_URI'],'/sort_id')!==false){
								echo preg_replace('/\/sort_id\/(\d+)/i', '/sort_id/4', $_SERVER['REQUEST_URI']);
						 	}else{
						 		if($a = strstr($_SERVER['REQUEST_URI'],'sort_id',true)){
						 			echo $a.sort_id.'='.'4';
						 		}else{
						 			echo $_SERVER['REQUEST_URI'].'&'.sort_id.'='.'4';
						 		};
							}
						?>">升级时间&nbsp;<img src="__IMG__/admin/icon_down.png" alt="" style="height: 15px;margin-left: 4px;"></a></th></eq>
						<eq name="username_status" value="5"><th><a  href="<?php
						 	if(strpos($_SERVER['REQUEST_URI'],'?')!==false){
						 		if($a = strstr($_SERVER['REQUEST_URI'],'sort_id',true)){
						 			echo $a.sort_id.'='.'5';
						 		}else{
						 			echo $_SERVER['REQUEST_URI'].'&'.sort_id.'='.'5';
						 		};
						 	}else if(strpos($_SERVER['REQUEST_URI'],'/sort_id')!==false){
								echo preg_replace('/\/sort_id\/(\d+)/i', '/sort_id/5', $_SERVER['REQUEST_URI']);
						 	}else{
						 		if($a = strstr($_SERVER['REQUEST_URI'],'sort_id',true)){
						 			echo $a.sort_id.'='.'5';
						 		}else{
						 			echo $_SERVER['REQUEST_URI'].'&'.sort_id.'='.'5';
						 		};
							}
						?>">升级时间&nbsp;<img src="__IMG__/admin/icon_up.png" alt="" style="height: 15px;margin-left: 4px;"></a></th></eq>
						<eq name="username_status" value="6"><th><a  href="<?php
						 	if(strpos($_SERVER['REQUEST_URI'],'?')!==false){
						 		if($a = strstr($_SERVER['REQUEST_URI'],'sort_id',true)){
						 			echo $a.sort_id.'='.'6';
						 		}else{
						 			echo $_SERVER['REQUEST_URI'].'&'.sort_id.'='.'6';
						 		};
						 	}else if(strpos($_SERVER['REQUEST_URI'],'/sort_id')!==false){
								echo preg_replace('/\/sort_id\/(\d+)/i', '/sort_id/6', $_SERVER['REQUEST_URI']);
						 	}else{
						 		if($a = strstr($_SERVER['REQUEST_URI'],'sort_id',true)){
						 			echo $a.sort_id.'='.'6';
						 		}else{
						 			echo $_SERVER['REQUEST_URI'].'&'.sort_id.'='.'6';
						 		};
							}
						?>">升级时间&nbsp;<img src="__IMG__/admin/icon_normal.png" alt="" style="height: 15px;margin-left: 4px;"></a></th></eq>
                        <th>原等级</th>
                        <th>升级等级</th>
                        <th>是否需要实体卡</th>
                    </tr>
                </thead>
                <tbody>
                    <volist name="lists" id="vo">
						<tr>
							<td ><input type="checkbox" class="order_check" name= "order_check[]" value="{$vo['cid']}"/>
							<td>{$vo.cid}</td>
							<td style = 'position:relative;color:blue;cursor: pointer;' class = 'detail'>{$vo.phone_number}</td>
							<td hidden>{$vo.cid}</td>
							<if condition="$vo.upgrade_level eq 2">
								<td >{$vo.one_number}</td>
								<td></td>
							<else/>
								<td></td>
								<td >{$vo.family_number}</td>
							</if>
							<td >{$vo.upgrade_time|date='Y-m-d H:i:s',###}</td>
							<td >{$vo.original_level_name}</td>
							<td >{$vo.upgrade_level_name}</td>
						   	<td status='{$vo.card_physical_type}'>{$vo.card_physical_type|getTypeText = ###,['1' => '是','2' => '否']}</td>
							<td hidden status='{$vo.cid_type}'>{$vo.cid_type|getTypeText = ###,['0' => '线上']}</td>
							<td hidden>{$vo.pay_account}</td>
							<td hidden>{$vo.journal}</td>
							<td hidden status="{$vo.pay_channel}">{$vo.pay_channel|getTypeText = ###,['0' => '微信','1' => '支付宝']}</td>
							<td hidden status="{$vo.pay_status}">{$vo.pay_status|getTypeText = ###,['0' => '待支付','1' => '成功']}</td>
							<td hidden>{$vo.pay_done_time|date='Y-m-d H:i:s',###}</td>
							<td hidden>{$vo.receive_person}</td>
							<td hidden>{$vo.phone}</td>
							<td hidden>{$vo.receive_address}</td>
						</tr>
                    </volist>
                </tbody>
            </table>
            <div class="row-fluid">
				<div class="pagination pull-right">
					{$_page}<div style="float:right;"><div style="margin-left: 13px;margin-right: 109px;margin-top: 5px;">共{$totalPages}页，共{$_total}条
					每页显示</div>
					<form class="pull-right" action="{:U('MemberLevel/record')}" method="GET" style="margin-right: 33px;margin-top:-24px;">
						<input type="text" name="pageSize" value="{$pageSize}" id="changePageSize" style="width:34px;"/>条
					</form></div>
				</div>
            </div>
        </div>
    </div>
</div>
	<style>
		.bg-grey{
			background-color: #fff !important;
			background-image: none !important;
		}
		.tile{
			border: 2px solid #ccc;
			color: #000;
		}
		.tile .tile-body{
			color: #000;
		}
		.tile .tile-body h4,.tile .tile-body h4:hover {
			color: #000;
		}
		.tile .tile-body p,.tile .tile-body p:hover,.tile .tile-body p:active,.tile .tile-body p:hover {
			color: #000;
		}
		.w25{width:25%;float:left;}

		.header>div:first-child{margin-bottom:10px;border-bottom:#e9e9e9 solid 1px;padding-bottom:5px;}
	</style>

<!--用户详情-->
	<div class="modal hide" id="user_info" style="width:888px;">

		<div class="modal-header">
			<button type="button" class="close" ></button>
			<h4 class="modal-title">详情</h4>
		</div>

		<div class="modal-body">
			<div>
				<div class="w25"><b>基本信息</b></div>
				<div class="w25">&nbsp;&nbsp;</div>
				<div class="w25"><b>付款信息</b></div>
				<div class="w25">&nbsp;&nbsp;</div>
			</div>
			<div>
				<div class="w25">编号</div>
				<div class="w25 cid">&nbsp;&nbsp;</div>
				<div class="w25">付款金额</div>
				<div class="w25 pay_account">&nbsp;&nbsp;</div>
			</div>
			<div>
				<div class="w25">会员手机号码</div>
				<div class="w25 user_mobile">&nbsp;&nbsp;</div>
				<div class="w25">付款流水</div>
				<div class="w25 journal">&nbsp;&nbsp;</div>
			</div>
			<div>
				<div class="w25">个人VIP卡号</div>
				<div class="w25  one_number">&nbsp;&nbsp;</div>
				<div class="w25">付款渠道</div>
				<div class="w25 pay_channel">&nbsp;&nbsp;</div>
			</div>
			<div>
				<div class="w25">家庭VIP卡号</div>
				<div class="w25 family_number">&nbsp;&nbsp;</div>
				<div class="w25">付款结果</div>
				<div class="w25 pay_status">&nbsp;&nbsp;</div>
			</div>
			<div>
				<div class="w25">升级时间</div>
				<div class="w25 upgrade_time">&nbsp;&nbsp;</div>
				<div class="w25">付款完成时间</div>
				<div class="w25 pay_done_time">&nbsp;&nbsp;</div>
			</div>
			<div>
				<div class="w25">原等级</div>
				<div class="w25 original_level">&nbsp;&nbsp;</div>
				<div class="w25">&nbsp;&nbsp;</div>
				<div class="w25">&nbsp;&nbsp;</div>
			</div>
			<div>
				<div class="w25">升级等级</div>
				<div class="w25 upgrade_level">&nbsp;&nbsp;</div>
				<div class="w25">&nbsp;&nbsp;</div>
				<div class="w25">&nbsp;&nbsp;</div>
			</div>
			<div>
				<div class="w25">类型</div>
				<div class="w25 cid_type">&nbsp;&nbsp;</div>
				<div class="w25">&nbsp;&nbsp;</div>
				<div class="w25">&nbsp;&nbsp;</div>
			</div>
			<div style="margin-left: 426px;">
			<div>
				<div class="w25"><b>邮寄信息</b></div>
				<div class="w25 user_come_from">&nbsp;&nbsp;</div>
				<div class="w25">&nbsp;&nbsp;</div>
				<div class="w25">&nbsp;&nbsp;</div>
			</div>
			<div>
				<div class="w25">是否需要实体卡</div>
				<div class="w25 card_physical_type">&nbsp;&nbsp;</div>
				<div class="w25">&nbsp;&nbsp;</div>
				<div class="w25">&nbsp;&nbsp;</div>
			</div>
			<div>
				<div class="w25">收件人</div>
				<div class="w25 receive_person">&nbsp;&nbsp;</div>
				<div class="w25">&nbsp;&nbsp;</div>
				<div class="w25">&nbsp;&nbsp;</div>
			</div>
			<div>
				<div class="w25">联系电话</div>
				<div class="w25 phone">&nbsp;&nbsp;</div>
				<div class="w25">&nbsp;&nbsp;</div>
				<div class="w25">&nbsp;&nbsp;</div>
			</div>
			<div>
				<div class="w25">收件地址</div>
				<div class="w25 receive_address" style="width: 324px;">&nbsp;&nbsp;</div>
				<div class="w25">&nbsp;&nbsp;</div>
				<div class="w25">&nbsp;&nbsp;</div>
			</div>
			</div>
		</div>
	</div>

</block>
<block name="js">
    <script type="text/javascript">
        seajs.use(['controller/member_level/MemberLevelController'],function(main){
            main.index();
        });
    </script>
</block>